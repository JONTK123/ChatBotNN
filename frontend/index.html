<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Mini-NN Online</title>

  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-2.34.0.min.js"></script>
  <!-- Cytoscape -->
  <script src="https://unpkg.com/cytoscape@3/dist/cytoscape.min.js"></script>

  <style>
    body{background:#121212;color:#e0e0e0;font-family:system-ui,sans-serif;margin:1rem;display:flex;justify-content:center}
    #container{width:100%;max-width:1400px}
    h1,h2{text-align:center;margin:.5em 0}
    textarea{display:block;margin:0 auto 1em;width:90%;max-width:500px;height:100px;padding:.5em;background:#1e1e1e;color:#fff;border:1px solid #444;border-radius:4px;font-size:1rem}
    label,button{color:#e0e0e0;font-size:1rem}
    button{background:#2a2a2a;border:1px solid #555;padding:.5em 1em;border-radius:4px;cursor:pointer;margin-left:.5em}
    button:hover{background:#444}
    #loading{text-align:center;color:#aaa;margin:1em 0}
    .flex{display:flex;gap:2em;align-items:flex-start;justify-content:space-between;flex-wrap:nowrap}
    #status-container{flex:0 0 400px;margin-left:-20px}
    #status{height:525px;overflow-y:auto;padding:1em;background:#1e1e1e;color:#ddd;font-family:monospace;font-size:.85rem;line-height:1.3;border-radius:8px;white-space:pre-wrap;word-break:break-word;scrollbar-width:thin}
    #status::-webkit-scrollbar{width:8px}
    #status::-webkit-scrollbar-thumb{background:#444;border-radius:4px}
    #status::-webkit-scrollbar-thumb:hover{background:#666}
    #graphs-container{flex-grow:3;flex-shrink:1;min-width:700px}
    #liveNet,#liveLoss{width:100%;height:550px;border:1px solid #444;background:#1a1a1a}
    .legend{font-size:.9rem;color:#bbb;margin-top:.5em;text-align:center}
    #finalSection{display:none;text-align:center;margin-top:2em}
    #finalImgs{text-align:center;margin-top:2em}
    #finalImgs img{max-width:90%;border:1px solid #444;margin:1em 0}
  </style>
</head>
<body>
  <div id="container">
    <h1>Mini Rede Neural ‚Äì Token Predict</h1>

    <textarea id="txt" placeholder="Digite pelo menos 5 frases‚Ä¶"></textarea>

    <div style="text-align:center; margin-bottom:1em;">
      <label>
        <input type="checkbox" id="modo2camadas">
        Usar 2 camadas ocultas
      </label>
      <button id="bt">Tokenizar!</button>
    </div>

    <div id="tokenInfo" style="text-align:center; margin:2em 0;">
      <h2>Pr√©-visualiza√ß√£o dos Tokens</h2>
      <div id="tokensDebug" style="background:#1e1e1e; padding:1em; border-radius:8px; max-height:400px; overflow:auto;"></div>
    </div>

    <div id="loading" style="display:none;">
      ‚è≥ Treinando‚Ä¶ por favor, aguarde.
    </div>

    <div class="flex">
      <div id="status-container">
        <h2>Status em Tempo Real</h2>
        <pre id="status">{}</pre>
      </div>

      <div id="graphs-container">
        <h2>Rede (embeddings ‚Üí hidden)</h2>
        <div id="liveNet"></div>

        <div class="legend">
          <h3 style="margin:.2em 0">Rede Neural</h3>
          <ul style="text-align:left; margin:0 auto; max-width:820px; line-height:1.4">
            <li><strong>Fun√ß√£o de ativa√ß√£o:</strong> usamos <code>tanh</code> em vez de <code>ReLU</code>.
              O <code>ReLU</code> √© mais est√°vel (menos picos), mas o <code>tanh</code> gera valores negativos e positivos,
              o que permite <u>visualizar as ativa√ß√µes com cores</u>:
              üîµ positivo, üî¥ negativo.</li>
            <li><strong>Embedding:</strong> cada token √© convertido em um vetor com <b>6 dimens√µes</b>.
              Essas coordenadas s√£o mostradas nas bolinhas <code>In_0</code> a <code>In_3</code>.</li>
            <li><strong>Entradas:</strong> os <b>√∫ltimos 4 tokens</b> de cada frase s√£o usados como entrada de uma vez.
              Eles formam o "contexto" para prever o pr√≥ximo token.</li>
            <li><strong>Sa√≠da real:</strong> a rede retorna um vetor (chamado <em>logits</em>) com uma pontua√ß√£o para <b>cada token do vocabul√°rio</b>.
              O token com maior valor √© considerado o mais prov√°vel como pr√≥ximo.</li>
            <li><strong>Sa√≠das exibidas:</strong> no grafo, mostramos apenas os <b>4 tokens mais prov√°veis</b> (os Top-4 logits) para facilitar a visualiza√ß√£o.</li>
            <li><strong>Setas coloridas:</strong> indicam altera√ß√µes de pesos durante o aprendizado:
              <span style="color:dodgerblue">üîµ azul</span> = peso aumentou |
              <span style="color:red">üî¥ vermelho</span> = peso diminuiu.
              A <b>espessura da linha</b> representa o quanto o peso mudou ‚Äî quanto maior a varia√ß√£o, mais grossa a linha.</li>
            <li><strong>Monitoramento:</strong> estamos visualizando apenas as conex√µes de entrada <code>E</code> para a primeira camada oculta <code>H1</code>
              (<code>E ‚Üí H1</code>). As demais conex√µes (<code>H1 ‚Üí H2</code> e <code>H1/H2 ‚Üí Out</code>) tamb√©m mudam,
              mas n√£o s√£o renderizadas no grafo para manter tudo leg√≠vel.</li>
            <li><strong>Treinamento:</strong> a rede passa <b>100 vezes</b> por todos os exemplos (100 √©pocas),
              permitindo que os pesos sejam ajustados gradualmente com base no erro cometido em cada passo.</li>
          </ul>
        </div>

        <h2>Perda ao Vivo</h2>
        <div id="liveLoss"></div>
        <div class="legend" style="margin-top: 1em;">
          <h3 style="margin:.2em 0">Gr√°fico de Perda</h3>
          <ul style="text-align:left; margin:0 auto; max-width:820px; line-height:1.4">
            <li><strong>O que √©:</strong> o gr√°fico mostra a <b>perda (Loss)</b> ao longo do tempo, indicando o erro da rede durante o treinamento.</li>
            <li><strong>Interpreta√ß√£o:</strong> valores mais baixos significam que o modelo est√° aprendendo corretamente.</li>
            <li><strong>Comportamento esperado:</strong> a linha deve descer gradualmente. Uma queda acentuada no in√≠cio √© comum, seguida de ajustes mais finos.</li>
            <li><strong>Problemas poss√≠veis:</strong> se a linha parar de descer ou oscilar muito, o modelo pode estar com dificuldade de aprender ou estar superajustando.</li>
          </ul>
        </div>

        <div id="tokenPredict" style="display:none;text-align:center;margin:2em 0">
          <h2>Prever o Pr√≥ximo Token</h2>
          <input id="tokenInput" placeholder="Digite parte de uma frase‚Ä¶"
                 style="width:60%;max-width:500px;padding:.5em;border-radius:4px;border:1px solid #555;background:#1e1e1e;color:#eee">
          <button id="btnToken" style="margin-left:.5em">Prever token</button>
          <div id="tokenOut" style="margin-top:1em;color:#8be9fd"></div>
        </div>
      </div>
    </div>

    <div id="finalLegend" class="legend" style="display:none; margin-top:1em; max-width:820px; margin-left:auto; margin-right:auto; text-align:left; line-height:1.4">
      <h3 style="margin: .2em 0">Gr√°ficos finais</h3>
      <ul>
        <li><strong>Loss por √âpoca:</strong> mostra o erro total da rede em cada √©poca. Quanto menor, melhor.</li>
        <li><strong>Acur√°cia:</strong> mostra quantas previs√µes foram corretas. Ideal √© pr√≥ximo de 100%.</li>
        <li><strong>Perplexidade:</strong> mede o qu√£o "surpreso" o modelo est√°. Quanto menor, mais confiante.</li>
        <li><strong>Precision / Recall / F1:</strong> m√©tricas cl√°ssicas de classifica√ß√£o. Mostram qu√£o equilibrado est√° o desempenho.</li>
        <li><strong>Top‚Äë10 Erros:</strong> tokens que a rede mais errou ao longo do treino. √ötil para analisar dificuldades.</li>
        <li><strong>Mapa 3D:</strong> mostra o valor do loss por batch em todas as √©pocas. Picos podem indicar instabilidade.</li>
        <li><strong>Matriz de Confus√£o:</strong> mostra onde a rede mais acerta ou erra. Ideal √© a diagonal estar destacada.</li>
     </ul>
    </div>

    <section id="finalImgs"></section>
  </div>

  <script src="script.js"></script>
</body>
</html>
